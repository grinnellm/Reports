---
author: "Jaclyn Cleary^[DFO Science, Pacific Biological Station (Jaclyn.Cleary@dfo-mpo.gc.ca).] and Matthew Grinnell^[DFO Science, Pacific Biological Station (Matthew.Grinnell@dfo-mpo.gc.ca).]"
date: "`r format(x = Sys.Date(), format = '%b %d, %Y')`"
params:
  title: "Pacific Herring preliminary data summary for"
  region: "Haida Gwaii"
  year: 2020
title: "`r paste(params$title, params$region, params$year)`"
urlcolor: blue
geometry: margin=3cm
output:
  pdf_document:
    number_sections: true
header-includes:
  - \usepackage{etoolbox}
  - \usepackage{nth}
  - \usepackage{animate}
  - \usepackage{booktabs}
  - \usepackage{placeins}
---

```{r setup, include=FALSE}
# Packages
library(knitr)
library(tidyverse)
library(here)
# Knitr options
opts_chunk$set(
  echo = TRUE,
  fig.align = "center"
)
# Regions
regions <- read_csv(
  file =
    "SAR, Region, RegionName, Major
          1, HG, Haida Gwaii, TRUE
          2, PRD, Prince Rupert District, TRUE
          3, CC, Central Coast, TRUE
          4, SoG, Strait of Georgia, TRUE
          5, WCVI, West Coast of Vancouver Island, TRUE
          6, A27, Area 27, FALSE
          7, A2W, Area 2 West, FALSE",
  col_types = cols("i", "c", "c", "l")
)
# Select region(s)/folder(s): major (HG, PRD, CC, SoG, WCVI); or minor (A27, A2W)
if (!exists("regName")) {
  regName <- regions$Region[regions$RegionName == params$region]
}
# Set the path to the R output, including a trailing separator
rPath <- file.path("..", "DataSummaries", regName, .Platform$file.sep)
# Load the R image
load(file = file.path(rPath, paste("Image", regName, "RData", sep = ".")))
# Set the path to the region-specific documents for LaTeX
docPath <- here(
  "RegionalText", params$year, regName, .Platform$file.sep # max(yrRange)
)
```

```{r, child='Document/00_Variables.Rmd', include=FALSE}
```

```{r checkYrs, echo=FALSE}
# Warning if years are not the same
if(max(yrRange)!=params$year)
  warning("Year mismatch", call.=FALSE)
```

\begin{center}
\begin{minipage}{0.45\linewidth}
\includegraphics{Document/HerringDFO.jpg}
\fishName{} (\scienceName{}). Image credit: \href{http://www.pac.dfo-mpo.gc.ca}{Fisheries and Oceans Canada}.
\end{minipage}
\end{center}

\vspace{1cm}
\hrule
\begin{description}
\item[Disclaimer] This report contains preliminary data collected for \fishName{} in \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR).
These data may differ from data used and presented in the final stock assessment.
\isSubset{}
\end{description}
\vspace{0.2cm}
\hrule

# Context

`r knit_child("Document/01_Context.Rmd")`

# Data collection programs

`r knit_child(paste0(docPath,"02_DataCollectionPrograms.Rmd"))`

<!-- Insert text for additional biosamples in CC StatArea 08, if required -->
`r ifelse(regName=="CC", knit_child("Document/02_CC08.Rmd"), "")`

# Catch and biological samples

`r knit_child("Document/03_CatchAndBiologicalSamples.Rmd")`

# Spawn survey data

`r knit_child("Document/04_SpawnSurveyData.Rmd")`

# General observations

`r knit_child("Document/05_GeneralObservations.Rmd")`

\clearpage

# Tables

`r knit_child("Document/06_Tables.Rmd")`

\clearpage

# Figures

`r knit_child("Document/07_Figures.Rmd")`
