%##############################################################################
% 
% Author:       Matthew H. Grinnell
% Affiliation:  Pacific Biological Station, Fisheries and Oceans Canada (DFO) 
% Group:        Inshore Assessment Section, Fish Population Assessment Division
% Address:      3190 Hammond Bay Road, Nanaimo, BC, Canada, V9T 6N7
% Contact:      e-mail: matt.grinnell@dfo-mpo.gc.ca | tel: 250.756.7055
% Project:      Herring
% Code name:    DataSummary.rnw
% Version:      1.0
% Date started: Jun 03, 2016
% Date edited:  Jul 10, 2018
% 
% Overview: 
% Generate annual preliminary data summary reports for Pacific herring by region 
% using this skeleton document and:
%   The custom style file: Document/HerringSummary.sty
%   Various R objects from the .RData file generated by 'Summary.R'.
%   Child documents: Document/Variables.rnw, and Document/Context.rnw.
%   Tables and figures inported from R output (*.tex ,and *.pdf, respectively).
%   Text files in /{Year}/{Region}/*.tex.
% 
% Requirements: 
% Links to the directory that contains output from the R script 'Summary.R',
% and links to the auxiliary text files /Year/Region/*.tex.
% 
% Notes: 
% This is a dynamic document (http://yihui.name/knitr/). All of the reports can
% be made at once by sourcing the R script 'MakeDataSummaries.R'
%
%##############################################################################

% Set document style and font size
\documentclass[12pt]{article}

% Style file for the data summaries
\usepackage{Document/HerringSummary}

<<loadImage, echo=FALSE, warning=FALSE>>=
# Load packages
require( knitr, quietly=TRUE )  # Dynamic documents
# Select region(s)/folder(s): major (HG, PRD, CC, SoG, WCVI); or minor (A27, A2W)
if( !exists('regName') )  regName <- "A2W"
# Set the path to the R output, including a trailing separator
rPath <- file.path( "..", "DataSummaries", regName, .Platform$file.sep )
# Load the R image
load( file=file.path(rPath, paste("Image", regName, "RData", sep=".")) )
# Set the path to the region-specific documents for LaTeX
docPath <- file.path( "RegionalText", max(yrRange), regName, 
  .Platform$file.sep )
@

% Load R variables, switches, etc
\Sexpr{knit_child('Document/Variables.rnw')}

% TODO: Wording in text and captions for 'tabBioNum' and 'tabBioTypeNum' re showing 'Representative' biological samples only (once the R script is updated). Use the command '\repSamples' below. This could also include the figure 'BioLocations.pdf' (Note that this creates issues with WCVI because of the cast-net biosamples, which are not representative, but are included in the data summary.)
% TODO: Active voice.
% TODO: Once the JS summary is sent/done, move text from 'Context.rnw' to this file.
% TODO: Add a note re SOK removals/mortality not included in catch (search for SOK).
% TODO: Add a table with weight- and/or length-at-age differences with respect to some reference period (i.e., 1980s).
% TODO: Remove comment about egregia SOK excluded from product weight once egregia is included in the SOK table.

% Begin the document
\begin{document}

% Add the title etc
\frontmatter

% Context section
\section{Context}

% Bring in stock text for context, with an update form \theFollowing
\Sexpr{knit_child('Document/Context.rnw')}

% Data collection programs section
\section{Data collection programs}

% Bring in custom text for data collection programs
\inputsp{\Sexpr{noquote(docPath)}DataCollectionPrograms.tex}

% Bring in stock text for additional biosamples in CC StatArea 08, if required
\Sexpr{ifelse(regName=="CC", knit_child('Document/CC08.rnw'), "")}

% Catch and biological samples section
\section{Catch and biological samples}

In the 1950s and 1960s, the reduction fishery dominated \fishName{} catch; starting in the 1970s, catch has been predominantly from roe seine and gillnet fisheries.
The reduction fishery is different from current fisheries in several ways.
First, the reduction fishery caught \fishName{} of all ages, whereas current fisheries target spawning (i.e., mature) fish.
Thus, reduction fisheries included age-1 fish which are not typically caught in current fisheries.
Second, the reduction fishery has some uncertainty regarding the quantity and location of catch; in some cases this may affect our ability to allocate catch to a specific SAR.
For the roe gillnet fishery, all \fishName{} catch has been validated by a dockside monitoring program since \Sexpr{validCatch$RoeGN}; the catch validation program started in \Sexpr{validCatch$RoeSN} for the roe seine fishery.
Finally, the reduction fishery operated during the winter months, whereas roe fisheries typically target spawning fish between February and April.

% Bring in custom text for catch and biological samples
\inputsp{\Sexpr{noquote(docPath)}CatchAndBiologicalSamples.tex}
Landed commercial catch of \fishName{} by year and fishery is shown in \autoref{tabCatchCommUseYr} and \autoref{figCatchGear}.
\iftoggle{catchStatArea}{In addition to annual catch variability, catch varies among Statistical Areas (\autoref{figCatchStatArea}).}{\unskip}
Total harvested spawn on kelp (SOK) in \thisYr{} in the \regionName{} \regionType{} SAR is shown in \autoref{tabHarvestSOK}; we also calculate the estimated spawning biomass associated with SOK harvest.
\spawnIndexTechReport{}
% Note that we do not account for SOK harvest removals in stock assessments. OR
% Currently, catch input to the stock assessment model does not include mortality from the commercial SOK fishery, nor any recreational or FSC fisheries.

In \thisYr{}, \Sexpr{nSampThisYr} \fishName{} biological samples were collected and processed for the \regionName{} \regionType{} SAR (\autoref{tabBioNum}, \autoref{tabBioTypeNum}), and a total of \Sexpr{numAgedThisYr} \fishName{} were aged in \thisYr{}. 
\iftoggle{numPropWtAge}{Differences between biological data collected from two sampling protocols regarding the number-, proportion-, weight-, and length-at-age for \fishName{} in \thisYr{} in the \regionName{} \regionType{} SAR are shown in \autoref{tabDeltaNumAgeYr}, \autoref{tabDeltaPropAgeYr}, \autoref{tabDeltaWtAgeYr}, and \autoref{tabDeltaLenAgeYr}, respectively.
The nearshore sampling program is a multi-year pilot study (using cast nets), therefore only biological data from the seine samples were used for the purposes of stock assessment.}{\unskip}
\iftoggle{biosamples}{The locations in which the biological samples were collected are presented in \autoref{figBioLocations}.}{\unskip}
\iftoggle{weightCatch}{Biological samples collected using seine gear shows that there is considerable variability in fish weight by year and sample type (\autoref{figWeightCatch}).}{\unskip}
Included herein are biological summaries of observed proportion-, number-, weight-, and length-at-age (\autoref{figProportionAged}, \autoref{tabPropAgedYearTab}, and \autoref{figWtLenAge}, respectively).
\iftoggle{weightGroup}{Some Statistical Areas tend to have larger fish at a given age (\autoref{figWeightAgeGroup}, \autoref{tabWeightAgeGroupN}).}{\unskip}
\seineSamples{}
\repSamples{}

% Spawn survey data section
\section{Spawn survey data}

\iftoggle{spawnByLoc}{\fishName{} spawn surveys were conducted at \Sexpr{nSpawnLoc} individual location\Sexpr{ifelse(nSpawnLoc>1, "s", "")} in \thisYr{} in the \regionName{} \regionType{} SAR (\autoref{tabSpawnByLoc}\iftoggle{spawnByLocXY}{, and \autoref{figSpawnByLoc}}{\unskip}).}
{No spawn surveys were conducted in \thisYr{} in the \regionName{} \regionType{} SAR.}
A summary of spawn from the last decade (\Sexpr{unique(spawnDecade$Decade)}) is shown in \autoref{figSpawnDecade}.
\autoref{figSpawnTiming} shows spawn start date by decade and \Sexpr{ifelse(spawnTimingGroup, "Group", "Statistical Area")}.
Spawn surveys are conducted to estimate the spawn length, width, number of egg layers, and substrate type, and these data are used to estimate the index of spawning biomass (i.e., the spawn index; \autoref{figSpawnIndexType}, \autoref{figSpawnDimensions}, \autoref{figSpawnIndexPercent}, \autoref{tabSpawnYrTab}, and \autoref{figSpawnIndexChange}).
We describe the calculations used to estimate the spawn index in the \href{https://github.com/grinnellm/HerringSpawnDocumentation/blob/master/SpawnIndexTechnicalReport.pdf}{draft spawn index techincal report}.
\iftoggle{spawnDepth}{In addition, spawn surveys estimate spawn depth by Statistical Area, and Section (\autoref{figSpawnDepth}).}{\unskip}
\spawnIndex{}
Therefore, these data do not represent model estimates of spawning biomass, and are considered the minimum observed spawning biomass derived from egg counts.
\qPeriods{}

Some \fishName{} Sections contribute more than others to the total spawn index, and the percentage contributed by Section varies yearly (\autoref{figSpawnIndexPercent}b, \autoref{figSpawnPercentPanel}). 
For example, in \thisYr{}, Section \Sexpr{pSpawnThisYr$Section} contributed the most to the spawn index (\Sexpr{pSpawnThisYr$Percent}\%). 
As with Sections, some \Sexpr{spawnIndexGroupName$a}s contribute more than others to the total spawn index (\autoref{figSpawnIndexPercent}c, \autoref{figSpawnPercentGrid}).
An animation shows the spawn index by spawn survey location from \Sexpr{min(yrRange)} to \thisYr{} (\autoref{figSpawnIndexAnimation}).

% General observations section
\section{General observations}

General observations provide context to the data summary report.
The following observations were reported by area DFO Resource Management staff, and DFO Science staff:

% Bring in custom text, usually a bullet list
\inputsp{\Sexpr{noquote(docPath)}GeneralObservations.tex}

% Start a new page, and then place the tables
\clearpage
\section{Tables}

\begin{table}[h]
\centering
\caption{\fishName{} stock assessment regions (SARs) in British Columbia.} 
\begin{tabular}{lll}
\toprule
\inputsp{\Sexpr{noquote(rPath)}Regions.tex}
\end{tabular}
\label{tabRegions}
\end{table}

\FloatBarrier
\begin{longtable}{\iftoggle{spatialGroup}{lrrl}{lrr}}
\caption{Statistical Areas\iftoggle{spatialGroup}{, Sections, and Groups}{ and Sections} for \fishName{} in the \regionName{} \regionType{} stock assessment region (SAR).
\Sexpr{spawnIndexGroupLegend}}\\
\toprule
\Sexpr{noquote(namesSpatialGroup)}\\
\midrule
\endfirsthead
\toprule
\multicolumn{\iftoggle{spatialGroup}{4}{3}}{c}{\emph{\tablename\ \thetable{} continued}}\\
\Sexpr{noquote(namesSpatialGroup)}\\
\midrule
\endhead
\bottomrule
\endfoot
\bottomrule
\endlastfoot
\inputsp{\Sexpr{noquote(rPath)}SpatialGroup.tex}%
\label{tabSpatialGroup}
\end{longtable}
\FloatBarrier

\begin{table}[h]
\centering
\caption{Total landed commercial catch of \fishName{} in metric tonnes (t) by gear type in \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR).
\legendGear{}
\noSOK{}
\withPrivacy{}}
\begin{tabular}{lr}
\toprule
\inputsp{\Sexpr{noquote(rPath)}CatchCommUseYr.tex}
\end{tabular}
\label{tabCatchCommUseYr}
\end{table}

\begin{table}[h]
\centering
\caption{Total harvested \fishName{} spawn on kelp (SOK) in pounds (lb), and the associated estimate of spawning biomass in metric tonnes (t) from \Sexpr{firstYrTab} to \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR).
\spawnIndexTechReport{}
\Sexpr{ifelse(region=="CC", "Harvest does not include the 2,411 lbs of spawn on egregia in 2018.", "%")}
\withPrivacy{}}
\begin{tabular}{rrr}
\toprule
\inputsp{\Sexpr{noquote(rPath)}HarvestSOK.tex}
\end{tabular}
\label{tabHarvestSOK}
\end{table}

\begin{table}[h]
\centering
\caption{Number of \fishName{} biological samples processed from \Sexpr{firstYrTab} to \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR).
\sampleSize{}} 
\begin{tabular}{rrrr}
\toprule
& \multicolumn{3}{c}{Number of samples}\\
\cmidrule{2-4}
\inputsp{\Sexpr{noquote(rPath)}BioNum.tex}
\end{tabular}
\label{tabBioNum}
\end{table}

\begin{table}[h]
\centering
\caption{Number and type of \fishName{} biological samples processed in \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR). 
\sampleSize{}} 
\begin{tabular}{lllr}
\toprule
\inputsp{\Sexpr{noquote(rPath)}BioTypeNum.tex}
\end{tabular}
\label{tabBioTypeNum}
\end{table}

\iftoggle{numPropWtAge}{
\begin{table}[h]
\centering
\caption{Observed number-at-age of \fishName{} by sample type in \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR). 
\plusGroup{}
\legendNear{}} 
\begin{tabular}\Sexpr{ageTableAlign}
\toprule
& \multicolumn{\Sexpr{length(ageRange)}}{c}{Number-at-age}\\
\cmidrule{2-\Sexpr{length(ageRange)+1}}
\inputsp{\Sexpr{noquote(rPath)}DeltaNumAgeYr.tex}
\end{tabular}
\label{tabDeltaNumAgeYr}
\end{table}

\begin{table}[h]
\centering
\caption{Observed proportion-at-age of \fishName{} by sample type in \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR). 
\plusGroup{}
\legendNear{}} 
\begin{tabular}\Sexpr{ageTableAlign}
\toprule
& \multicolumn{\Sexpr{length(ageRange)}}{c}{Proportion-at-age}\\
\cmidrule{2-\Sexpr{length(ageRange)+1}}
\inputsp{\Sexpr{noquote(rPath)}DeltaPropAgeYr.tex}
\end{tabular}
\label{tabDeltaPropAgeYr}
\end{table}

\begin{table}[h]
\centering
\caption{Observed mean weight-at-age in grams (g) of \fishName{} by sample type in \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR). 
\plusGroup{}
\legendNear{}} 
\begin{tabular}\Sexpr{ageTableAlign}
\toprule
& \multicolumn{\Sexpr{length(ageRange)}}{c}{Mean weight-at-age (g)}\\
\cmidrule{2-\Sexpr{length(ageRange)+1}}
\inputsp{\Sexpr{noquote(rPath)}DeltaWtAgeYr.tex}
\end{tabular}
\label{tabDeltaWtAgeYr}
\end{table}

\begin{table}[h]
\centering
\caption{Observed mean length-at-age in millimetres (mm) of \fishName{} by sample type in \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR). 
\plusGroup{}
\legendNear{}} 
\begin{tabular}\Sexpr{ageTableAlign}
\toprule
& \multicolumn{\Sexpr{length(ageRange)}}{c}{Mean length-at-age (mm)}\\
\cmidrule{2-\Sexpr{length(ageRange)+1}}
\inputsp{\Sexpr{noquote(rPath)}DeltaLenAgeYr.tex}
\end{tabular}
\label{tabDeltaLenAgeYr}
\end{table}
}{\unskip}

\begin{table}[h]
\centering
\caption{Observed proportion-at-age for \fishName{} from \Sexpr{firstYrTab} to \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR). 
\plusGroup{}} 
\begin{tabular}\Sexpr{ageTableAlign}
\toprule
& \multicolumn{\Sexpr{length(ageRange)}}{c}{Proportion-at-age}\\
\cmidrule{2-\Sexpr{length(ageRange)+1}}
\inputsp{\Sexpr{noquote(rPath)}PropAgedYearTab.tex}
\end{tabular}
\label{tabPropAgedYearTab}
\end{table}

\iftoggle{weightGroup}{
\begin{table}[h]
\centering
\caption{Sample size for \fishName{} weight-at-age analysis in \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR) by Group from the most recent decade (\Sexpr{wtAgeYrRanges$recent}), and the previous decade (\Sexpr{wtAgeYrRanges$previous}), as displayed in \autoref{figWeightAgeGroup}. 
\seineSamples{}
\plusGroup{}
\Sexpr{spawnIndexGroupLegend}}
\begin{tabular}{lrrr}
\toprule
& & \multicolumn{2}{c}{Sample size}\\
\cmidrule{3-4}
\inputsp{\Sexpr{noquote(rPath)}WeightAgeGroupN.tex}
\end{tabular}
\label{tabWeightAgeGroupN}
\end{table}
}{\unskip}

\iftoggle{spawnByLoc}{
\FloatBarrier
\begin{longtable}{rrllr}
\caption{\fishName{} spawn survey location\Sexpr{ifelse(nrow(spawnByLoc)>1, "s", "")}, start date, and spawn index in metric tonnes (t) in \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR).
\spawnIndex{}
\missingSpawn{NAs}}\\
\toprule
\Sexpr{noquote(namesSpawnLoc)}\\ 
\midrule
\endfirsthead
\toprule
\multicolumn{5}{c}{\emph{\tablename\ \thetable{} continued}}\\
\Sexpr{noquote(namesSpawnLoc)}\\ 
\midrule
\endhead
\bottomrule
\endfoot
\bottomrule
\endlastfoot
\inputsp{\Sexpr{noquote(rPath)}SpawnByLoc.tex}%
\label{tabSpawnByLoc}
\end{longtable}
\FloatBarrier
}{\unskip}

\begin{table}[h]
\centerfloat
\caption{Summary of \fishName{} spawn survey data from \Sexpr{firstYrTab} to \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR). 
\qPeriods{}
\spawnIndex{}
Units: metres (m), and metric tonnes (t).}
\begin{tabular}{rrrrr}
\toprule
\inputsp{\Sexpr{noquote(rPath)}SpawnYrTab.tex}
\end{tabular}
\label{tabSpawnYrTab}
\end{table}

% Start a new page, and then place the figures
\clearpage
\section{Figures}

\begin{figure}[h]
\centering
\includegraphics[width=\linewidth]{BC.pdf}
\caption{Boundaries for the \fishName{} stock assessment regions (SARs) in British Columbia: there are \Sexpr{length(allRegions$major)} major SARs (\Sexpr{PasteNicely(allRegions$major)}), and \Sexpr{length(allRegions$minor)} minor SARs (\Sexpr{PasteNicely(allRegions$minor)}; \autoref{tabRegions}).
Units: kilometres (km).}
\label{figBC}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[width=\linewidth]{Region.pdf}
\caption{Boundaries for the \regionName{} \regionType{} stock assessment region (SAR; thick dashed lines), associated Statistical Areas (SA; thin solid lines), and associated Sections (thin dotted lines).
Units: kilometres (km).
\Sexpr{spawnIndexGroupLegend}}
\label{figRegion}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[width=\linewidth]{CatchGear.pdf}
\caption{Time series of total landed catch in thousands of metric tonnes ($\text{t} \times 10^{3}$) of \fishName{} by gear type from \Sexpr{min(yrRange)} to \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR).
\legendGear{}
\noSOK{}}
\label{figCatchGear}
\end{figure}

\iftoggle{catchStatArea}{
\begin{figure}[h]
\centering
\includegraphics[width=\linewidth]{CatchStatArea.pdf}
\caption{Time series of total landed catch in thousands of metric tonnes ($\text{t} \times 10^{3}$) of \fishName{} by Statistical Area (SA) from \Sexpr{firstYrFig} to \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR).
\darkThisYr{}}
\label{figCatchStatArea}
\end{figure}
}{\unskip}

\iftoggle{biosamples}{
\begin{figure}[h]
\centering
\includegraphics[width=\linewidth]{BioLocations.pdf}
\caption{Location and type of \fishName{} biological samples collected in \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR; thick dashed lines), and associated Section\Sexpr{ifelse(length(unique(areas$Section))>1, "s", "")} (Sec; thin solid lines).
Units: kilometres (km).}
\label{figBioLocations}
\end{figure}
}{\unskip}

\iftoggle{weightCatch}{
\begin{figure}[h]
\centering
\includegraphics[width=\linewidth]{WeightCatch.pdf}
\caption{Time series of weight in grams (g) of \fishName{} by sample type from \Sexpr{firstYrTab} to \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR) in Statistical Areas 14 and 17.
The outer edges of the boxes indicate the \nth{25} and \nth{75} percentiles, and the middle lines indicate the \nth{50} percentiles (i.e., medians).
The whiskers extend to $1.5 \times \text{IQR}$, where IQR is the distance between the \nth{25} and \nth{75} percentiles, and dots indicate outliers.
Horizontal dashed lines indicate the mean weight-at-age for age-\Sexpr{min(ageRange)} (lowest line) to age-\Sexpr{max(ageRange)} (incrementing higher from age-\Sexpr{min(ageRange)}) fish. 
\seineSamples{}
\plusGroup{}}
\label{figWeightCatch}
\end{figure}
}{\unskip}

\begin{figure}[h]
\centering
\includegraphics[width=\linewidth]{ProportionAged.pdf}
\caption{Time series of observed proportion-at-age (a) and number aged in thousands (c) of \fishName{} from \Sexpr{min(yrRange)} to \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR). 
The black line is the mean age, and the shaded area is the approximate \Sexpr{ciLevel*100}\% distribution. 
\seineSamples{}
\plusGroup{}}
\label{figProportionAged}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[width=\linewidth]{WtLenAge.pdf}
\caption{Time series of weight-at-age in grams (g; panel a) and length-at-age in milimetres (mm; panel b) for age-\Sexpr{ageShow} (circles) and \Sexpr{nRoll}-year running mean weight- and length-at-age (lines) for \fishName{} from \Sexpr{min(yrRange)} to \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR). 
% Lines show \Sexpr{nRoll}-year running means for age-\Sexpr{min(ageRange)} to age-\Sexpr{max(ageRange)} fish (incrementing higher from the lowest line); the thick black line highlights age-\Sexpr{ageShow} fish.
Missing weight- and length-at-age values (i.e., years with no biological samples) are imputed using one of two methods: missing values at the beginning of the time series are imputed by extending the first non-missing value backwards; other missing values are imputed as the mean of the previous \Sexpr{nRoll} years.
\seineSamples{}
\plusGroup{}}
\label{figWtLenAge}
\end{figure}

\iftoggle{weightGroup}{
\begin{figure}[h]
\centering
\includegraphics[width=\linewidth]{WeightAgeGroup.pdf}
\caption{Weight-at-age in grams (g) of \fishName{} in the \regionName{} \regionType{} stock assessment region (SAR) by Group from the most recent decade (\Sexpr{wtAgeYrRanges$recent}), and the previous decade (\Sexpr{wtAgeYrRanges$previous}). 
The outer edges of the boxes indicate the \nth{25} and \nth{75} percentiles, and the middle lines indicate the \nth{50} percentiles (i.e., medians).
The whiskers extend to $1.5 \times \text{IQR}$, where IQR is the distance between the \nth{25} and \nth{75} percentiles, and dots indicate outliers.
Sample sizes are given in \autoref{tabWeightAgeGroupN}.
\seineSamples{}
\plusGroup{}
\Sexpr{spawnIndexGroupLegend}}
\label{figWeightAgeGroup}
\end{figure}
}{\unskip}

\iftoggle{spawnByLoc}{
\iftoggle{spawnByLocXY}{
\begin{figure}[h]
\centering
\includegraphics[width=\linewidth]{SpawnByLoc.pdf}
\caption{\fishName{} spawn survey location\Sexpr{ifelse(nrow(spawnByLoc)>1, "s", "")}, and spawn index in metric tonnes (t) in \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR; thick dashed lines), and associated Section\Sexpr{ifelse(length(unique(areas$Section))>1, "s", "")} (Sec; thin solid lines).
\spawnIndex{}
\missingSpawn{grey circles}
Units: kilometres (km).}
\label{figSpawnByLoc}
\end{figure}
}{}
}{\unskip}

\begin{figure}[h]
\centering
\includegraphics[width=\linewidth]{SpawnDecade.pdf}
\caption{\fishName{} spawn survey location\Sexpr{ifelse(nrow(spawnByLoc)>1, "s", "")}, mean spawn index in metric tonnes (t), and spawn frequency from \Sexpr{unique(spawnDecade$Decade)} in the \regionName{} \regionType{} stock assessment region (SAR; thick dashed lines), and associated Section\Sexpr{ifelse(length(unique(areas$Section))>1, "s", "")} (Sec; thin solid lines).
\spawnIndex{}
\missingSpawn{grey circles}
%Note that the mean excludes years when no spawn was reported.
Units: kilometres (km).}
\label{figSpawnDecade}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[width=\linewidth]{SpawnTiming.pdf}
\caption{\fishName{} spawn start date by decade and \Sexpr{ifelse(spawnTimingGroup, "Group", "Statistical Area")}.
Grey shaded regions indicate March \nth{1} to \nth{31}.
Note that spawn size and intensity varies; therefore the number of spawns is not directly proportional to spawn extent or biomass.
\Sexpr{ifelse(spawnTimingGroup, spawnIndexGroupLegend, "")}}
\label{figSpawnTiming}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[width=\linewidth]{SpawnIndexType.pdf}
\caption{Time series of spawn index in thousands of metric tonnes ($\text{t} \times 10^{3}$) by type for \fishName{} from \Sexpr{firstYrFig} to \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR). 
%\trendLine{}
\spawnTypes{}
\qPeriods{}}
\label{figSpawnIndexType}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[width=\linewidth]{SpawnDimensions.pdf}
\caption{Time series of total spawn length in thousands of metres ($\text{m} \times 10^{3}$; panel a), mean spawn width in metres (b), and mean number of egg layers (c) for \fishName{} from \Sexpr{firstYrFig} to \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR). 
%\trendLine{}
\qPeriods{}}
\label{figSpawnDimensions}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[width=\linewidth]{SpawnIndexPercent.pdf}
\caption{Time series of spawn index in thousands of metric tonnes ($\text{t} \times 10^{3}$) for \fishName{} from \Sexpr{firstYrFig} to \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR; panel a), as well as percent contributed by \Sexpr{spawnIndexGroupName$b}, and Section (b, \& c, respectively). 
%\trendLine{}
\qPeriods{}
\spawnIndex{}
\Sexpr{spawnIndexGroupLegend}}
\label{figSpawnIndexPercent}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[width=\linewidth]{SpawnIndexChange.pdf}
\caption{Time series of spawn index in thousands of metric tonnes ($\text{t} \times 10^{3}$) for \fishName{} from \Sexpr{firstYrFig} to \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR; panel a), and percent change (b).
We calculate percent change as $\delta_t=\frac{I_t - I_{t-1}}{I_{t-1}}$ where $\mli{I}_t$ is the spawn index in year $t$.
%\trendLine{}
\qPeriods{}
\spawnIndex{}}
\label{figSpawnIndexChange}
\end{figure}

\iftoggle{spawnDepth}{
\begin{figure}[h]
\centering
\includegraphics[width=\linewidth]{SpawnDepthSASec.pdf}
\caption{Time series of maximum spawn depth in metres (m) for \fishName{} from \Sexpr{firstYrFig} to \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR) by Statistical Area (SA; panel a), and Section (b).
Note that depth is not corrected to the chart datum.
\qPeriods{}}
\label{figSpawnDepth}
\end{figure}
}{\unskip}

\begin{figure}[h]
\centering
\includegraphics[width=\linewidth]{SpawnPercentPanel.pdf}
\caption{Time series of percent of spawn index by Section for \fishName{} from \Sexpr{firstYrFig} to \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR). 
\darkThisYr{}
\qPeriods{}
\spawnIndex{}}
\label{figSpawnPercentPanel}
\end{figure}

\begin{figure}[h]
\centering
\includegraphics[width=\linewidth]{SpawnPercentGrid.pdf}
\caption{Time series of percent of spawn index by \Sexpr{spawnIndexGroupName$b} and Section for \fishName{} from \Sexpr{firstYrFig} to \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR). 
\qPeriods{}
\spawnIndex{}
\Sexpr{spawnIndexGroupLegend}}
\label{figSpawnPercentGrid}
\end{figure}

\begin{figure}[h]
\centering
\animategraphics[width=\linewidth]{1}{\Sexpr{rPath}SpawnIndexAnimation}{}{}
\caption{Animation of \fishName{} spawn survey locations and spawn index in metric tonnes (t) from \Sexpr{min(yrRange)} to \thisYr{} in the \regionName{} \regionType{} stock assessment region (SAR; thick dashed lines), and associated Section\Sexpr{ifelse(length(unique(areas$Section))>1, "s", "")} (Sec; thin solid lines).
\qPeriods{}
\spawnIndex{}
\missingSpawn{grey circles}
The inset shows the total spawn index by year.
Units: kilometres (km).}
\label{figSpawnIndexAnimation}
\end{figure}

% Fin
\end{document}
